{"version":3,"sources":["gianism-mastodon-script.js"],"names":["jQuery","document","ready","$","dialog","autoOpen","modal","open","event","ui","hide","JSON","parse","localStorage","getItem","forEach","element","append","attr","addClass","text","click","preventDefault","val","close","removeClass","empty","buttons","url","button","this","data","getJSON","wpApiSettings","root","done","instance","uri","recently_items","index","indexOf","splice","unshift","length","setItem","stringify","href","found","match","encodeURIComponent","location","fail","error","show","focus","id","ajax","method","dataType","beforeSend","xhr","setRequestHeader","nonce","textStatus","jqXHR","acct","instance_url","on","e","f","currentTarget","v","selin","prop","selout","tag","target","substr","selectionStart","selectionEnd","trigger"],"mappings":"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","file":"../gianism-mastodon-script.js","sourcesContent":["jQuery(document).ready(function ($) {\n\n\t'use strict';\n\n\t$( \"#connect_to_instance\" ).dialog({\n\t\tautoOpen: false,\n\t\tmodal: true,\n\t\topen: function(event, ui) {\n\t\t\t$(\".ui-dialog-titlebar-close\").hide();\n\t\t\tvar recently_items = JSON.parse(localStorage.getItem('gianism-mastodon-recently-use-instance')) || [];\n\t\t\trecently_items.forEach( function(element) {\n\t\t\t\tif(element) {\n\t\t\t\t\t$( \"#recentry-instances\" ).append(\n\t\t\t\t\t\t$('<li>').append(\n\t\t\t\t\t\t\t$('<a>').attr('href', element).attr('rel', 'nofollow').addClass('wpg-button connect').text(element)\n\t\t\t\t\t\t\t.click(function(event) {\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t$('#instance_url').val(element);\n\t\t\t\t\t\t\t\t$( \"#dialog_accept_button\" ).click();\n\t\t\t\t\t})));\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tclose: function(event, ui) {\n\t\t\t$('#connect_to_instance_error').hide();\n\t\t\t$('#instance_url').removeClass('ui-state-error').val('');\n\t\t\t$( \"#recentry-instances\" ).empty();\n\t\t},\n\t\tbuttons: [\n\t\t\t{\n\t\t\t\ttext: 'OK',\n\t\t\t\tclick: function() {\n\t\t\t\t\tvar url = $('#instance_url').val();\n\t\t\t\t\tvar button = $(this).data('link');\n\t\t\t\t\t$.getJSON( wpApiSettings.root + 'gianism-mastodon/v1/instance', {\n\t\t\t\t\t\turl: url\n\t\t\t\t\t})\n\t\t\t\t\t.done( function(instance) {\n\t\t\t\t\t\tif('uri' in instance) {\n\t\t\t\t\t\t\tvar uri = instance.uri;\n\t\t\t\t\t\t\tvar recently_items = JSON.parse(localStorage.getItem('gianism-mastodon-recently-use-instance')) || [];\n\t\t\t\t\t\t\tvar index = recently_items.indexOf(uri);\n\t\t\t\t\t\t\tif( index >= 0 ) {\n\t\t\t\t\t\t\t\trecently_items.splice(index, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trecently_items.unshift(uri);\n\t\t\t\t\t\t\trecently_items.length = 5;\n\t\t\t\t\t\t\tlocalStorage.setItem('gianism-mastodon-recently-use-instance', JSON.stringify(recently_items));\n\t\t\t\t\t\t\tvar href = button.href;\n\t\t\t\t\t\t\tvar found = href.match(/^(.*instance_url=)%2A(.*)$/);\n\t\t\t\t\t\t\tif(found) {\n\t\t\t\t\t\t\t\thref = found[1] + encodeURIComponent(url) + found[2];\n\t\t\t\t\t\t\t\tlocation.href = href;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail( function(error) {\n\t\t\t\t\t\t$('#connect_to_instance_error').show();\n\t\t\t\t\t\t$('#instance_url').addClass('ui-state-error').focus();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tid: 'dialog_accept_button',\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Cancel',\n\t\t\t\tclick: function() {\n\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t},\n\t\t\t}\n\t\t],\n\t});\n\t$( \".with-instance-dialog\" ).click(function(event) {\n\t\tevent.preventDefault();\n\t\t$( \"#connect_to_instance\" ).data('link', this).dialog('open');\n\t});\n\n\t$( \"#comment_link_acct_delete_dialog\" ).dialog({\n\t\tautoOpen: false,\n\t\tmodal: true,\n\t\topen: function(event, ui) {\n\t\t\t$(\".ui-dialog-titlebar-close\").hide();\n\t\t},\n\t\tbuttons: [\n\t\t\t{\n\t\t\t\ttext: 'OK',\n\t\t\t\tclick: function() {\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: wpApiSettings.root + 'gianism-mastodon/v1/comment_link',\n\t\t\t\t\t\tmethod: 'DELETE',\n\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\tbeforeSend: function ( xhr ) {\n\t\t\t\t\t\t\txhr.setRequestHeader( 'X-WP-Nonce', wpApiSettings.nonce );\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.done( function(data, textStatus, jqXHR) {\n\t\t\t\t\t\t$(\"#comment_link_acct_delete_dialog\").dialog(\"close\");\n\t\t\t\t\t})\n\t\t\t\t\t.fail( function(data, textStatus, jqXHR) {\n\t\t\t\t\t\t$(\"#comment_link_acct\").val( $(\"#comment_link_acct\").data('previouse_selected_value') );\n\t\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Cancel',\n\t\t\t\tclick: function() {\n\t\t\t\t\t$(\"#comment_link_acct\").val( $(\"#comment_link_acct\").data('previouse_selected_value') );\n\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t},\n\t\t\t}\n\t\t],\n\t});\n\t$( \"#comment_link_acct_dialog\" ).dialog({\n\t\tautoOpen: false,\n\t\tmodal: true,\n\t\topen: function(event, ui) {\n\t\t\t$(\".ui-dialog-titlebar-close\").hide();\n\t\t},\n\t\tbuttons: [\n\t\t\t{\n\t\t\t\ttext: 'OK',\n\t\t\t\tclick: function() {\n\t\t\t\t\tvar acct = $( \"#comment_link_acct\" ).val();\n\t\t\t\t\tvar href = $( \"#comment_link_acct\" ).data('href');\n\t\t\t\t\t$.ajax({\n\t\t\t\t\t\turl: wpApiSettings.root + 'gianism-mastodon/v1/extract_domain',\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\turl: acct\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\tbeforeSend: function ( xhr ) {\n\t\t\t\t\t\t\txhr.setRequestHeader( 'X-WP-Nonce', wpApiSettings.nonce );\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.done( function(data) {\n\t\t\t\t\t\tvar found = href.match(/^(.*instance_url)(.*)$/);\n\t\t\t\t\t\tif(found) {\n\t\t\t\t\t\t\thref = found[1] + '=' + encodeURIComponent(data.instance_url) + '&amp;acct=' + encodeURIComponent(acct) + found[2];\n\t\t\t\t\t\t\tlocation.href = href;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail( function() {\n\t\t\t\t\t\t$(\"#comment_link_acct\").val( $(\"#comment_link_acct\").data('previouse_selected_value') );\n\t\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Cancel',\n\t\t\t\tclick: function() {\n\t\t\t\t\t$(\"#comment_link_acct\").val( $(\"#comment_link_acct\").data('previouse_selected_value') );\n\t\t\t\t\t$(this).dialog(\"close\");\n\t\t\t\t},\n\t\t\t}\n\t\t],\n\t});\n\t$( \"#comment_link_acct\" )\n\t.on('focus', function(event) {\n\t\t$(this).data('previouse_selected_value', $(this).val());\n\t})\n\t.on('change', function(event) {\n\t\tvar acct = $(this).val();\n\t\tif( acct ) {\n\t\t\t$( \"#comment_link_acct_dialog\" ).data('link', this).dialog('open');\n\t\t} else {\n\t\t\t$( \"#comment_link_acct_delete_dialog\" ).dialog('open');\n\t\t}\n\t});\n\t$(document).on('click', '.tag_insert_buttons', function(e) {\n\t\tvar f      = '#' + $(e.currentTarget).data('for');\n\t\tvar v      = $(f).val();\n\t\tvar selin  = $(f).prop('selectionStart');\n\t\tvar selout = $(f).prop('selectionEnd');\n\t\tvar tag    = $(e.target).text();\n\t\t$(f).val( v.substr(0,selin) + tag + v.substr(selout) ).prop({\n\t\t\t\"selectionStart\": selin + tag.length,\n\t\t\t\"selectionEnd\":   selin + tag.length,\n\t\t})\n\t\t.trigger(\"focus\");\n\t});\n});\n"]}